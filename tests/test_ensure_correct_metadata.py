import json
from pathlib import Path

import pytest

from tests.test_correct_folder_structure import folders_without_meta, results_folder

model_rev_pairs = [
    (model_folder, rev_folder)
    for model_folder in results_folder.glob("*")
    for rev_folder in model_folder.glob("*")
    if model_folder.name not in [".DS_Store"]
    and rev_folder.name not in [".DS_Store"]
    and ((model_folder.name, rev_folder.name) not in folders_without_meta)
]

model_folders = [
    folder
    for folder in results_folder.glob("*")
    if folder.is_dir() and folder.name not in [".DS_Store"]
]


@pytest.mark.parametrize("model_rev_pair", model_rev_pairs)
def test_model_meta_in_folders(model_rev_pair):
    """
    Models added after the 26th of November should contain a model_meta.json file
    """
    model_folder, rev_folder = model_rev_pair

    meta_file = rev_folder / "model_meta.json"
    assert meta_file.exists()
    assert meta_file.is_file()
    assert meta_file.parent == rev_folder
    assert meta_file.suffix == ".json"
    assert meta_file.stem == "model_meta"


# please do not add to this list, this is only for historic results, all new results should include a revision ID
revision_exceptions = [
    ("castorini__mdpr-tied-pft-msmarco", "no_revision_available"),
    ("voyageai__voyage-3", "no_revision_available"),
    ("sentence-transformers__all-mpnet-base-v2", "no_revision_available"),
    ("Snowflake__snowflake-arctic-embed-m-v1.5", "no_revision_available"),
    ("sentence-transformers__all-MiniLM-L12-v2", "no_revision_available"),
    ("nthakur__mcontriever-base-msmarco", "no_revision_available"),
    ("voyageai__voyage-3-lite", "no_revision_available"),
    ("google-bert__bert-base-uncased", "no_revision_available"),
    ("google-bert__bert-large-uncased", "no_revision_available"),
    ("google-gecko__text-embedding-004", "no_revision_available"),
    ("hkunlp__instructor-large", "no_revision_available"),
    ("hkunlp__instructor-base", "no_revision_available"),
    ("flaubert__flaubert_base_cased", "no_revision_available"),
    ("google-bert__bert-base-multilingual-cased", "no_revision_available"),
    ("google-bert__bert-base-multilingual-uncased", "no_revision_available"),
    ("hkunlp__instructor-xl", "no_revision_available"),
    ("google-gecko__text-embedding-004-256", "no_revision_available"),
    ("google__flan-t5-large", "no_revision_available"),
    ("flaubert__flaubert_large_cased", "no_revision_available"),
    ("flaubert__flaubert_base_uncased", "no_revision_available"),
    ("google__flan-t5-base", "no_revision_available"),
    ("Haon-Chen__speed-embedding-7b-instruct", "external"),
    ("sdadas__mmlw-e5-large", "external"),
    ("twadada__mpn", "external"),
    ("starsy__gte-Qwen2-7B-instruct", "external"),
    ("lightonai__modernbert-embed-large-unsupervised", "external"),
    ("barisaydin__gte-base", "external"),
    ("llmrails__ember-v1", "external"),
    ("barisaydin__bge-large-en", "external"),
    ("mixedbread-ai__mxbai-embed-large-v1", "external"),
    ("arkohut__jina-embeddings-v2-base-zh", "external"),
    ("zhou-xl__bi-cse", "external"),
    ("Shimin__LLaMA-embeeding", "external"),
    ("McGill-NLP__LLM2Vec-Llama-2-7b-chat-hf-mntp-unsup-simcse", "external"),
    ("michaelfeil__ct2fast-bge-small-en-v1.5", "external"),
    ("Mihaiii__Venusaur", "external"),
    ("McGill-NLP__LLM2Vec-Sheared-LLaMA-mntp-supervised", "external"),
    ("ilhamdprastyo__jina-embeddings-v3-tei", "external"),
    ("jingyeom__korean_embedding_model", "external"),
    ("HIT-TMG__KaLM-embedding-multilingual-max-instruct-v1", "external"),
    ("Snowflake__snowflake-arctic-embed-s", "external"),
    ("Omartificial-Intelligence-Space__GATE-AraBert-v1", "external"),
    ("BillSYZhang__gte-Qwen2-7B-instruct-Q4-mlx", "external"),
    ("chuxin-llm__Chuxin-Embedding", "external"),
    ("jinaai__jina-embedding-l-en-v1", "external"),
    ("ibm-granite__granite-embedding-125m-english", "external"),
    ("izhx__udever-bloom-1b1", "external"),
    ("neofung__LdIR-Qwen2-reranker-1.5B", "external"),
    ("deepfile__multilingual-e5-small-openvino", "external"),
    ("barisaydin__gte-large", "external"),
    ("consciousAI__cai-stellaris-text-embeddings", "external"),
    ("nvidia__NV-Embed-v2", "external"),
    ("Marqo__marqo-chimera-arctic-bge-m", "external"),
    ("katanemo__bge-large-en-v1.5", "external"),
    ("joteqwork__new_gsev0", "external"),
    ("DecisionOptimizationSystemProduction__DeepFeatTextEmbeddingLarge", "external"),
    ("Narsil__bge-base-en", "external"),
    ("liujiarik__lim_base_zh", "external"),
    ("PotatoOff__mxbai-embed-large-safetensors", "external"),
    ("ekorman-strive__bge-large-en-v1.5", "external"),
    ("barisaydin__bge-small-en", "external"),
    ("Omartificial-Intelligence-Space__Arabic-labse-Matryoshka", "external"),
    ("vprelovac__universal-sentence-encoder-large-5", "external"),
    ("Geolumina__instructor-xl", "external"),
    ("DivineNnamdi__jina-embeddings-v3", "external"),
    ("twadada__s2v-gcp-pca", "external"),
    ("neuralmagic__bge-small-en-v1.5-quant", "external"),
    ("delwinn__stella_en_1.5B_v5", "external"),
    ("OrlikB__st-polish-kartonberta-base-alpha-v1", "external"),
    ("yessilver__new_model", "external"),
    ("woody72__multilingual-e5-base", "external"),
    ("twadada__wl_sw_256", "external"),
    ("liddlefish__privacy_embedding_rag_10k_tmp", "external"),
    ("michaelfeil__ct2fast-e5-large", "external"),
    ("shubham-bgi__UAE-Large", "external"),
    ("jspringer__echo-mistral-7b-instruct-lasttoken", "external"),
    ("Jaume__gemma-2b-embeddings", "external"),
    ("intfloat__multilingual-e5-small", "external"),
    ("Lajavaness__bilingual-embedding-base", "external"),
    ("BASF-AI__nomic-embed-text-v1.5", "external"),
    ("twadada__nmc-cls-50_correct", "external"),
    ("lier007__xiaobu-embedding-v2", "external"),
    ("sensenova__piccolo-base-zh", "external"),
    ("malenia1__ternary-weight-embedding", "external"),
    ("openbmb__MiniCPM-Embedding", "external"),
    ("vectoriseai__bge-large-en-v1.5", "external"),
    ("twadada__nmc-cls-200_correct", "external"),
    ("barisaydin__bge-base-en", "external"),
    ("Alibaba-NLP__gte-large-en-v1.5", "external"),
    ("jinaai__jina-embeddings-v3", "external"),
    ("michaelfeil__ct2fast-bge-base-en-v1.5", "external"),
    ("bigscience__sgpt-bloom-7b1-msmarco", "external"),
    ("silverjam__jina-embeddings-v2-base-zh", "external"),
    ("gall88__gte-Qwen2-7B-instruct-fp16", "external"),
    ("tomaarsen__mxbai-embed-large-v1-exported", "external"),
    ("thenlper__gte-base-zh", "external"),
    ("neofung__LdIR-reranker-large", "external"),
    ("mixedbread-ai__mxbai-embed-2d-large-v1", "external"),
    ("mixedbread-ai__mxbai-embed-xsmall-v1", "external"),
    ("Aleph-Alpha__Pharia-1-Embedding-4608-control", "external"),
    ("twadada__sup-cse", "external"),
    ("liddlefish__privacy_embedding_bge_small_synthetic", "external"),
    ("ai-sage__Giga-Embeddings-instruct", "external"),
    ("qinxianliu__FAE-v1", "external"),
    ("LuminaInc__jina-embeddings-v3", "external"),
    ("intfloat__e5-large", "external"),
    ("twadada__mpn-wordpca", "external"),
    ("cgldo__semanticClone", "external"),
    ("weakit-v__bge-base-en-v1.5-onnx", "external"),
    ("fangxq__XYZ-embedding-zh-v2", "external"),
    ("TaylorAI__bge-micro-v2", "external"),
    ("alexlimh__jasper_en_vision_language_v1", "external"),
    ("biswa921__bge-m3", "external"),
    ("Muennighoff__SGPT-5.8B-weightedmean-msmarco-specb-bitfit", "external"),
    ("silma-ai__silma-embeddding-sts-v0.1", "external"),
    ("BAAI__bge-large-en", "external"),
    ("twadada__st-mpnet_original", "external"),
    ("huizhang0110__hui-embedding", "external"),
    ("google__Gemma-Embeddings-v0.8", "external"),
    ("jncraton__gte-tiny-ct2-int8", "external"),
    ("twadada__nmc-300-w50k-b10k", "external"),
    ("ildodeltaRule__multilingual-e5-large", "external"),
    ("twadada__GTE256_sw", "external"),
    ("twadada__mpn-nobivec", "external"),
    ("sdadas__mmlw-roberta-large", "external"),
    ("Lenovo-Zhihui__Zhihui_LLM_Embedding", "external"),
    ("twadada__kom2", "external"),
    ("avsolatorio__GIST-Embedding-v0", "external"),
    ("omarelshehy__Arabic-STS-Matryoshka", "external"),
    ("lgbird__stella_1.5B_custom", "external"),
    ("avsolatorio__GIST-small-Embedding-v0", "external"),
    ("Omartificial-Intelligence-Space__Arabic-mpnet-base-all-nli-triplet", "external"),
    ("thenlper__gte-large", "external"),
    ("Amu__tao-8k", "external"),
    ("jinaai__jina-embedding-s-en-v1", "external"),
    ("minishlab__potion-base-8M", "external"),
    ("HIT-TMG__KaLM-embedding-multilingual-mini-v1", "external"),
    ("baseplate__instructor-large-1", "external"),
    ("CAiRE__UniVaR-lambda-1", "external"),
    ("vectoriseai__gte-large", "external"),
    ("twadada__ft-gcp-pca", "external"),
    ("Forbu14__openai_clip_embeddings", "external"),
    ("sentosa__ZNV-Embedding", "external"),
    ("qinxianliu__FUE-v1", "external"),
    ("hkunlp__instructor-xl", "external"),
    ("BAAI__bge-small-en", "external"),
    ("vectoriseai__instructor-large", "external"),
    ("twadada__tst2", "external"),
    ("neofung__bge-reranker-large-1k", "external"),
    ("infgrad__stella-base-zh-v3-1792d", "external"),
    ("sam-babayev__zzz", "external"),
    ("bennegeek__stella_en_1.5B_v5", "external"),
    ("minishlab__potion-base-2M", "external"),
    ("aari1995__German_Semantic_STS_V2", "external"),
    ("jinaai__jina-embeddings-v2-small-en", "external"),
    ("NLPArtisan__qwen-1.8b-retrieval-test", "external"),
    ("twadada__GTE_wl_mv", "external"),
    ("AdrienB134__llm2vec-occiglot-mntp", "external"),
    ("manu__sentence_croissant_alpha_v0.1", "external"),
    ("sionic-ai__sionic-ai-v1", "external"),
    ("IEITYuan__Yuan-embedding-1.0", "external"),
    ("sdadas__mmlw-e5-base", "external"),
    ("izhx__udever-bloom-3b", "external"),
    ("parasail-ai__GritLM-7B-vllm", "external"),
    ("Alibaba-NLP__gte-base-en-v1.5", "external"),
    ("fdehlinger__english-4U-bge-small", "external"),
    ("newsrx__instructor-xl-newsrx", "external"),
    ("neofung__m3e-ernie-xbase-zh", "external"),
    ("WhereIsAI__UAE-Large-V1", "external"),
    ("McGill-NLP__LLM2Vec-Mistral-7B-Instruct-v2-mntp-unsup-simcse", "external"),
    ("intfloat__multilingual-e5-large", "external"),
    ("ibm-granite__granite-embedding-107m-multilingual", "external"),
    ("abhinand__MedEmbed-small-v0.1", "external"),
    ("michaelfeil__ct2fast-e5-small", "external"),
    ("Pristinenlp__alime-reranker-large-zh", "external"),
    ("intfloat__e5-large-v2", "external"),
    ("SmartComponents__bge-micro-v2", "external"),
    ("arkohut__jina-embeddings-v3", "external"),
    ("twadada__lma-nobivec", "external"),
    ("arkohut__jina-embeddings-v2-base-en", "external"),
    ("qinxianliu__FAB-Ramy-v1", "external"),
    ("binqiangliu__EmbeddingModlebgelargeENv1.5", "external"),
    ("shanghung__stella-base-zh-v3-1792d", "external"),
    ("twadada__kom", "external"),
    ("nomic-ai__nomic-embed-text-v1-ablated", "external"),
    ("ISOISS__jina-embeddings-v3-tei", "external"),
    ("OrcaDB__cde-small-v1", "external"),
    ("vectoriseai__bge-small-en", "external"),
    ("BAAI__bge-large-en-v1.5", "external"),
    ("gentlebowl__instructor-large-safetensors", "external"),
    ("twadada__lma_noabtt", "external"),
    ("Nextcloud-AI__multilingual-e5-large-instruct", "external"),
    ("Snowflake__snowflake-arctic-embed-l-v2.0", "external"),
    ("jamesdborin__jina-v2-base-en-embed", "external"),
    ("benayad7__concat-e5-small-bge-small-01", "external"),
    ("twadada__nmc-cls-500_correct", "external"),
    ("nomic-ai__modernbert-embed-base-unsupervised", "external"),
    ("twadada__ft-lower", "external"),
    ("qihoo360__360Zhinao-search", "external"),
    ("barisaydin__gte-small", "external"),
    ("yibinlei__LENS-d8000", "external"),
    ("tomaarsen__mxbai-embed-large-v1-test", "external"),
    ("Mihaiii__Squirtle", "external"),
    ("radames__e5-large", "external"),
    ("twadada__nmc-cls-nobiv", "external"),
    ("intfloat__e5-small-v2", "external"),
    ("willalexm__potion-base-8M-stf", "external"),
    ("sensenova__piccolo-large-zh", "external"),
    ("avsolatorio__GIST-large-Embedding-v0", "external"),
    ("voyageai__voyage-code-3", "external"),
    ("twadada__nmc-nignore50", "external"),
    ("Omartificial-Intelligence-Space__Arabic-Triplet-Matryoshka-V2", "external"),
    ("akarum__cloudy-large-zh", "external"),
    ("vectoriseai__e5-large", "external"),
    ("Salesforce__SFR-Embedding-Mistral", "external"),
    ("liddlefish__privacy_embedding_rag", "external"),
    ("brahmairesearch__slx-v0.1", "external"),
    ("davidpeer__gte-small", "external"),
    ("jncraton__gte-small-ct2-int8", "external"),
    ("Lajavaness__bilingual-embedding-large-8k", "external"),
    ("twadada__lma-wordpca", "external"),
    ("minishlab__M2V_base_glove", "external"),
    ("w601sxs__b1ade-embed-kd_3", "external"),
    ("newsrx__instructor-large", "external"),
    ("Frazic__udever-bloom-3b-sentence", "external"),
    ("intfloat__e5-base", "external"),
    ("McGill-NLP__LLM2Vec-Sheared-LLaMA-mntp-unsup-simcse", "external"),
    ("sdadas__mmlw-e5-small", "external"),
    ("Labib11__MUG-B-1.6", "external"),
    ("mukaj__fin-mpnet-base", "external"),
    ("Muennighoff__SGPT-125M-weightedmean-msmarco-specb-bitfit", "external"),
    ("izhx__udever-bloom-560m", "external"),
    ("VectorStackAI__vstackai-law-1", "external"),
    ("DMetaSoul__sbert-chinese-general-v1", "external"),
    ("goldenrooster__multilingual-e5-large", "external"),
    ("anttip__ct2fast-e5-small-v2-hfie", "external"),
    ("vectoriseai__e5-base", "external"),
    ("ibm-granite__granite-embedding-278m-multilingual", "external"),
    ("jxm__cde-small-v2", "external"),
    ("twadada__nmc-cls-300_correct", "external"),
    ("CAiRE__UniVaR-lambda-20", "external"),
    ("iamgroot42__rover_nexus", "external"),
    ("twadada__lma", "external"),
    ("Alibaba-NLP__gte-Qwen2-1.5B-instruct", "external"),
    ("vprelovac__universal-sentence-encoder-4", "external"),
    ("twadada__nmc-prmt-and-emb", "external"),
    ("twadada__nmc-prmpt", "external"),
    ("Mihaiii__Ivysaur", "external"),
    ("qihoo360__360Zhinao-1.8B-Reranking", "external"),
    ("neuralmagic__bge-small-en-v1.5-sparse", "external"),
    ("GameScribes__stella_en_400M_v5", "external"),
    ("CAiRE__UniVaR-lambda-80", "external"),
    ("OysterHR__gte-base-en-v1.5", "external"),
    ("lier007__xiaobu-embedding", "external"),
    ("pingkeest__learning2_model", "external"),
    ("twadada__nmc-300-w30k-b10k", "external"),
    ("twadada__nmc-300-w75k-b10k", "external"),
    ("bijaygurung__stella_en_400M_v5", "external"),
    ("vectoriseai__gte-small", "external"),
    ("OrdalieTech__Solon-embeddings-large-0.1", "external"),
    ("dumyy__sft-bge-small", "external"),
    ("thenlper__gte-small", "external"),
    ("sam-babayev__sf_model_e5", "external"),
    ("Classical__Yinka", "external"),
    ("Koat__gte-tiny", "external"),
    ("GritLM__GritLM-8x7B", "external"),
    ("ClayAtlas__winberta-large", "external"),
    ("Snowflake__snowflake-arctic-embed-m-v2.0", "external"),
    ("ai-forever__FRIDA", "external"),
    ("retrainai__instructor-xl", "external"),
    ("Alibaba-NLP__gte-Qwen1.5-7B-instruct", "external"),
    ("Amu__tao", "external"),
    ("aws-neuron__bge-base-en-v1-5-seqlen-384-bs-1", "external"),
    ("twadada__GTE512_sw", "external"),
    ("Research2NLP__electrical_stella", "external"),
    ("compressa-ai__Compressa-Embeddings", "external"),
    ("giulio98__placeholder", "external"),
    ("Alignment-Lab-AI__e5-mistral-7b-instruct", "external"),
    ("twadada__mxb", "external"),
    ("BAAI__bge-en-icl", "external"),
    ("intfloat__e5-small", "external"),
    ("twadada__mpn-noabtt", "external"),
    ("Shimin__yiyouliao", "external"),
    ("omarelshehy__Arabic-Retrieval-v1.0", "external"),
    ("Cohere__Cohere-embed-english-v3.0", "external"),
    ("twadada__nmc-cls-noabtt", "external"),
    ("amazon__Titan-text-embeddings-v2", "external"),
    ("twadada__lma3-correct", "external"),
    ("consciousAI__cai-lunaris-text-embeddings", "external"),
    ("Muennighoff__SGPT-5.8B-weightedmean-nli-bitfit", "external"),
    ("zhilinw6__gmodel", "external"),
    ("Lajavaness__bilingual-document-embedding", "external"),
    ("zeroshot__gte-large-quant", "external"),
    ("d0rj__e5-large-en-ru", "external"),
    ("andersonbcdefg__bge-small-4096", "external"),
    ("facebook__SONAR", "external"),
    ("avsolatorio__NoInstruct-small-Embedding-v0", "external"),
    ("twadada__s2v-gcp", "external"),
    ("Omartificial-Intelligence-Space__Arabert-all-nli-triplet-Matryoshka", "external"),
    ("lixsh6__XLM-0B6-embedding", "external"),
    ("Alibaba-NLP__gme-Qwen2-VL-7B-Instruct", "external"),
    ("HIT-TMG__KaLM-embedding-multilingual-mini-instruct-v1", "external"),
    ("shhy1995__AGE_Hybrid", "external"),
    ("hkunlp__instructor-base", "external"),
    ("BAAI__bge-reranker-large", "external"),
    ("hsikchi__dump", "external"),
    ("silma-ai__silma-embeddding-matryoshka-v0.1", "external"),
    ("nvidia__NV-Embed-v1", "external"),
    ("twadada__l3_wl", "external"),
    ("Alibaba-NLP__gte-Qwen2-7B-instruct", "external"),
    ("Consensus__instructor-base", "external"),
    ("zeroshot__gte-small-quant", "external"),
    ("DMetaSoul__Dmeta-embedding-zh", "external"),
    ("vectoriseai__e5-large-v2", "external"),
    ("ClayAtlas__winberta-base", "external"),
    ("jinaai__jina-embeddings-v2-base-de", "external"),
    ("vectoriseai__e5-base-v2", "external"),
    ("zeroshot__gte-large-sparse", "external"),
    ("Snowflake__snowflake-arctic-embed-l", "external"),
    ("DMetaSoul__Dmeta-embedding-zh-small", "external"),
    ("karsar__paraphrase-multilingual-MiniLM-L12-hu_v1", "external"),
    ("minishlab__M2V_base_output", "external"),
    ("OrcaDB__gte-base-en-v1.5", "external"),
    ("recipe__embeddings", "external"),
    ("twadada__fasttext", "external"),
    ("AbderrahmanSkiredj1__Arabic_text_embedding_for_sts", "external"),
    ("shibing624__text2vec-base-multilingual", "external"),
    ("PaDaS-Lab__arctic-s-bge-small", "external"),
    ("Quark-LLM__quark-llm-embedding-8B", "external"),
    ("sthuck__gte-Qwen2-7B-instruct-bfloat16", "external"),
    ("tomaarsen__bge-small-en-v1.5-copy", "external"),
    ("zhonghhh__text_emb_V1", "external"),
    ("infgrad__stella-base-zh-v2", "external"),
    ("Cohere__Cohere-embed-multilingual-light-v3.0", "external"),
    ("neuralmagic__bge-large-en-v1.5-sparse", "external"),
    ("intfloat__multilingual-e5-large-instruct", "external"),
    ("jamesgpt1__sf_model_e5", "external"),
    ("Erin__IYun-large-zh", "external"),
    ("Muennighoff__SGPT-2.7B-weightedmean-msmarco-specb-bitfit", "external"),
    ("Alibaba-NLP__gme-Qwen2-VL-2B-Instruct", "external"),
    ("Lajavaness__bilingual-embedding-small", "external"),
    ("nickprock__stsbm-sentence-flare-it", "external"),
    ("infgrad__stella-base-en-v2", "external"),
    ("neuralmagic__bge-large-en-v1.5-quant", "external"),
    ("Alibaba-NLP__gte-multilingual-base", "external"),
    ("TaylorAI__gte-tiny", "external"),
    ("t12e__instructor-base", "external"),
    ("lixsh6__MegatronBert-1B3-embedding", "external"),
    ("srikanthmalla__BAAI-bge-reranker-large", "external"),
    ("OrlikB__KartonBERT-USE-base-v1", "external"),
    ("Hiveurban__multilingual-e5-large-pooled", "external"),
    ("BeastyZ__e5-R-mistral-7b", "external"),
    ("billatsectorflow__stella_en_400M_v5", "external"),
    ("ByteDance__ListConRanker", "external"),
    ("nomic-ai__nomic-embed-text-v1-unsupervised", "external"),
    ("Snowflake__snowflake-arctic-embed-m", "external"),
    ("michaelfeil__ct2fast-bge-large-en-v1.5", "external"),
    ("towing__gte-small-zh", "external"),
    ("vectoriseai__e5-small-v2", "external"),
    ("omarelshehy__arabic-english-sts-matryoshka", "external"),
    ("izhx__udever-bloom-7b1", "external"),
    ("liddlefish__privacy_embedding_rag_10k_base_checkpoint_2", "external"),
    ("vectoriseai__bge-base-en-v1.5", "external"),
    ("manu__sentence_croissant_alpha_v0.4", "external"),
    ("liddlefish__privacy_embedding_rag_10k_base_final", "external"),
    ("beademiguelperez__sentence-transformers-multilingual-e5-small", "external"),
    ("Mihaiii__gte-micro-v3", "external"),
    ("pengql__checkpoint-9000", "external"),
    ("BAAI__bge-base-en-v1.5", "external"),
    ("liddlefish__privacy_embedding_rag_10k_base_15_final", "external"),
    ("HIT-TMG__KaLM-embedding-multilingual-mini-instruct-v1.5", "external"),
    ("Maxthemacaque__onnx-gte-multilingual-base", "external"),
    ("manu__sentence_croissant_alpha_v0.3", "external"),
    ("PaDaS-Lab__arctic-m-bge-small", "external"),
    ("blevlabs__stella_en_v5", "external"),
    ("Mihaiii__gte-micro-v4", "external"),
    ("nvidia__NV-Retriever-v1", "external"),
    ("manu__bge-m3-custom-fr", "external"),
    ("EdwardBurgin__paraphrase-multilingual-mpnet-base-v2", "external"),
    ("TencentBAC__Conan-embedding-v1", "external"),
    ("jinaai__jina-embeddings-v2-base-zh", "external"),
    ("Snowflake__snowflake-arctic-embed-m-v1.5", "external"),
    ("RookieHX__bge_m3e_stella", "external"),
    ("BASF-AI__nomic-embed-text-v1", "external"),
    ("Gameselo__STS-multilingual-mpnet-base-v2", "external"),
    ("thtang__ALL_862873", "external"),
    ("sdadas__mmlw-roberta-base", "external"),
    ("omarelshehy__Arabic-STS-Matryoshka-V2", "external"),
    ("Hum-Works__lodestone-base-4096-v1", "external"),
    ("Linq-AI-Research__Linq-Embed-Mistral", "external"),
    ("McGill-NLP__LLM2Vec-Llama-2-7b-chat-hf-mntp-supervised", "external"),
    ("sergeyzh__rubert-tiny-turbo", "external"),
    ("jncraton__e5-small-v2-ct2-int8", "external"),
    ("minishlab__potion-base-4M", "external"),
    ("jburmeister__stella_en_400M_v5", "external"),
    ("mixamrepijey__instructor-small", "external"),
    ("srikanthmalla__hkunlp-instructor-xl", "external"),
    ("twadada__mpn-nopca", "external"),
    ("Mihaiii__Wartortle", "external"),
    ("tomaarsen__bge-base-en-v1.5", "external"),
    ("dunzhang__stella_en_1.5B_v5", "external"),
    ("infgrad__stella-large-zh-v2", "external"),
    ("fangxq__XYZ-embedding-zh", "external"),
    ("dunzhang__stella-large-zh-v3-1792d", "external"),
    ("nickprock__mmarco-sentence-flare-it", "external"),
    ("manu__sentence_croissant_alpha_v0.2", "external"),
    ("maiyad__multilingual-e5-small", "external"),
    ("sionic-ai__sionic-ai-v2", "external"),
    ("BookingCare__multilingual-e5-base-similarity-v1-onnx-quantized", "external"),
    ("yco__bilingual-embedding-base", "external"),
    ("twadada__mv_sw", "external"),
    ("twadada__nmc-wordpca", "external"),
    ("jncraton__multilingual-e5-small-ct2-int8", "external"),
    ("Mihaiii__gte-micro-v2", "external"),
    ("BAAI__bge-base-en", "external"),
    ("michaelfeil__ct2fast-gte-base", "external"),
    ("aliakseilabanau__bge-small-en", "external"),
    ("nomic-ai__modernbert-embed-base", "external"),
    ("vectoriseai__bge-small-en-v1.5", "external"),
    ("w601sxs__b1ade-embed-kd", "external"),
    ("Omartificial-Intelligence-Space__Marbert-all-nli-triplet-Matryoshka", "external"),
    ("intfloat__multilingual-e5-base", "external"),
    ("odunola__e5-base-v2", "external"),
    ("intfloat__e5-base-v2", "external"),
    (
        "Omartificial-Intelligence-Space__Arabic-MiniLM-L12-v2-all-nli-triplet",
        "external",
    ),
    ("Muennighoff__SGPT-125M-weightedmean-nli-bitfit", "external"),
    ("voyageai__voyage-3-m-exp", "external"),
    ("ai-forever__ru-en-RoSBERTa", "external"),
    ("CAiRE__UniVaR-lambda-5", "external"),
    ("twadada__nmc-pmpt_correct", "external"),
    ("twadada__nmc-nignore15", "external"),
    ("ahmet1338__finetuned_embedder", "external"),
    ("Intel__neural-embedding-v1", "external"),
    ("twadada__nmc-300-w50k-b30k", "external"),
    ("barisaydin__text2vec-base-multilingual", "external"),
    ("liddlefish__privacyembeddingv2_bge_small", "external"),
    ("twadada__ft-lower-pca", "external"),
    ("starsy__bge-en-icl", "external"),
    ("twadada__nmc-nignore30", "external"),
    ("biggunnyso4__stella_en_400M_v5_cpu", "external"),
    ("Snowflake__snowflake-arctic-embed-xs", "external"),
    ("zeta-alpha-ai__Zeta-Alpha-E5-Mistral", "external"),
    ("Mihaiii__gte-micro", "external"),
    ("ibm-granite__granite-embedding-30m-english", "external"),
    ("arcdev__SFR-Embedding-Mistral", "external"),
    ("twadada__lma3", "external"),
    ("sigridjineth__stella_en_1.5B_v5_sigrid", "external"),
    ("McGill-NLP__LLM2Vec-Meta-Llama-3-8B-Instruct-mntp-unsup-simcse", "external"),
    ("tanmaylaud__ret-phi2-v0", "external"),
    ("lightbird-ai__nomic", "external"),
    ("technicolor__Angle_BERT", "external"),
    ("jhu-clsp__FollowIR-7B", "external"),
    ("dwzhu__e5-base-4k", "external"),
    ("Mihaiii__test25", "external"),
    ("infgrad__stella-large-zh", "external"),
    ("Lajavaness__bilingual-embedding-large", "external"),
    ("twadada__nmc-cls", "external"),
    ("arcdev__e5-mistral-7b-instruct", "external"),
    ("odunola__UAE-Large-VI", "external"),
    ("minishlab__M2V_base_glove_subword", "external"),
    ("wongctroman__hktv-fine-tuned-cloudy-large-zh-metaphor14", "external"),
    ("Severian__nomic", "external"),
    ("infly__inf-retriever-v1", "external"),
    ("Snowflake__snowflake-arctic-embed-m-long", "external"),
    ("tsirif__BinGSE-Sheared-LLaMA", "external"),
    ("vectoriseai__multilingual-e5-large", "external"),
    ("Erin__mist-zh", "external"),
    ("w601sxs__b1ade-embed", "external"),
    ("michaelfeil__ct2fast-gte-large", "external"),
    ("twadada__lma-nopca", "external"),
    ("lixsh6__XLM-3B5-embedding", "external"),
    ("Marqo__dunzhang-stella_en_400M_v5", "external"),
    ("jncraton__bge-small-en-ct2-int8", "external"),
    ("TownsWu__PEG", "external"),
    ("corto-ai__bge-reranker-large-onnx", "external"),
    ("bigscience-data__sgpt-bloom-1b7-nli", "external"),
    ("Mihaiii__test24", "external"),
    ("sensenova__piccolo-large-zh-v2", "external"),
    ("newsrx__instructor-large-newsrx", "external"),
    ("gizmo-ai__Cohere-embed-multilingual-v3.0", "external"),
    ("koble-ai__jina-embeddings-v3", "external"),
    ("liddlefish__privacy_embedding_rag_10k_base_12_final", "external"),
    ("billatsectorflow__stella_en_1.5B_v5", "external"),
    ("markaw__NV-Embed-v2", "external"),
    ("BAAI__bge-small-en-v1.5", "external"),
    ("openbmb__MiniCPM-Embedding-Light", "external"),
    ("twadada__lma2", "external"),
    ("SkyeTeam__stella_en_400m", "external"),
    ("atian-chapters__Chapters-SFR-Embedding-Mistral", "external"),
    ("yibinlei__LENS-d4000", "external"),
    ("ieasybooks__multilingual-e5-large-onnx", "external"),
    ("vprelovac__universal-sentence-encoder-multilingual-large-3", "external"),
    ("Mihaiii__Bulbasaur", "external"),
    ("corto-ai__nomic-embed-text-v1", "external"),
    ("BAAI__bge-reranker-base", "external"),
    ("khoa-klaytn__bge-small-en-v1.5-angle", "external"),
    ("aspire__acge_text_embedding", "external"),
    ("AdrienB134__llm2vec-croissant-mntp", "external"),
    ("google__text-embedding-005", "external"),
    ("Cohere__Cohere-embed-english-light-v3.0", "external"),
    ("twadada__s2v", "external"),
    ("jncraton__GIST-small-Embedding-v0-ct2-int8", "external"),
    ("T3LS__stella-mrl-large-zh-v3.5-1792d-1024", "external"),
    ("fresha__e5-large-v2-endpoint", "external"),
    ("thenlper__gte-base", "external"),
    ("twadada__llm_mse", "external"),
    ("dunzhang__stella-mrl-large-zh-v3.5-1792d", "external"),
    ("deepfile__multilingual-e5-small-onnx-qint8", "external"),
    ("michaelfeil__ct2fast-e5-small-v2", "external"),
    ("Muennighoff__SGPT-1.3B-weightedmean-msmarco-specb-bitfit", "external"),
    ("iampanda__zpoint_large_embedding_zh", "external"),
    ("twadada__ft-gcp", "external"),
    ("Einas__einas_ashkar", "external"),
    ("raghavlight__TDTE", "external"),
    ("ManiShankar-AlpesAi__paraphrase-multilingual-mpnet-base-v2-KE_Sieve", "external"),
    ("neuralmagic__bge-base-en-v1.5-sparse", "external"),
    ("ggrn__e5-small-v2", "external"),
    ("twadada__nmc-prmt-and-emb-150k", "external"),
    ("jinaai__jina-embeddings-v2-base-en", "external"),
    ("ClayAtlas__windberta-large", "external"),
    ("vectoriseai__ember-v1", "external"),
    ("twadada__nmc-cls-nopca", "external"),
    ("google__Gemma-Embeddings-v1.0", "external"),
    ("linhphanff__stella_en_1.5B_v5_clone", "external"),
    ("deepfile__embedder-100p", "external"),
    ("Omartificial-Intelligence-Space__Arabic-all-nli-triplet-Matryoshka", "external"),
    ("PaDaS-Lab__arctic-l-bge-small", "external"),
    ("omarelshehy__arabic-english-sts-matryoshka-v2.0", "external"),
    ("BAAI__bge-multilingual-gemma2", "external"),
    ("raghavlight__SE_v1", "external"),
    ("twadada__tst", "external"),
    ("khoa-klaytn__bge-base-en-v1.5-angle", "external"),
    ("thenlper__gte-small-zh", "external"),
    ("nickprock__mmarco-bert-base-italian-uncased", "external"),
    ("jncraton__stella-base-en-v2-ct2-int8", "external"),
    ("McGill-NLP__LLM2Vec-Mistral-7B-Instruct-v2-mntp-supervised", "external"),
    ("twadada__un-sim", "external"),
    ("twadada__komni", "external"),
    ("DecisionOptimizationSystem__DeepFeatEmbeddingLargeContext", "external"),
    ("Quark-LLM__quark-llm-embedding-1.5B", "external"),
    ("Salesforce__SFR-Embedding-2_R", "external"),
    ("twadada__nmc-cls-100_correct", "external"),
    ("infgrad__stella-base-zh", "external"),
    ("TitanML__jina-v2-base-en-embed", "external"),
    ("Pristinenlp__alime-embedding-large-zh", "external"),
    ("jinaai__jina-embedding-b-en-v1", "external"),
    ("rlsChapters__Chapters-SFR-Embedding-Mistral", "external"),
    ("tsirif__BinGSE-Meta-Llama-3-8B-Instruct", "external"),
    ("jxm__cde-small-v1", "external"),
    ("twadada__gte_wl", "external"),
    ("vprelovac__universal-sentence-encoder-multilingual-3", "external"),
    ("ef-zulla__e5-multi-sml-torch", "external"),
    ("lsf1000__bge-evaluation", "external"),
    ("karsar__gte-multilingual-base-hu", "external"),
    ("krilecy__e5-mistral-7b-instruct", "external"),
    ("mixamrepijey__instructor-models", "external"),
    ("vectoriseai__gte-base", "external"),
    ("Cohere__Cohere-embed-multilingual-v3.0", "external"),
    ("aiacademyvn__multilingual-e5-large-instruct", "external"),
    (
        "AbderrahmanSkiredj1__arabic_text_embedding_sts_arabertv02_arabicnlitriplet",
        "external",
    ),
    ("michaelfeil__ct2fast-e5-large-v2", "external"),
    ("mgoin__all-MiniLM-L6-v2-ds", "external"),
    ("infgrad__jasper_en_vision_language_v1", "external"),
    ("Marqo__multilingual-e5-small", "external"),
    ("Jechto__e5-dansk-test-0.1", "external"),
    ("neuralmagic__bge-base-en-v1.5-quant", "external"),
    ("TaylorAI__bge-micro", "external"),
    ("intfloat__e5-mistral-7b-instruct", "external"),
    ("McGill-NLP__LLM2Vec-Meta-Llama-3-8B-Instruct-mntp-supervised", "external"),
    ("karsar__paraphrase-multilingual-MiniLM-L12-hu-v2", "external"),
    ("dhairya0907__thenlper-get-large", "external"),
    ("dunzhang__stella_en_400M_v5", "external"),
    ("avsolatorio__GIST-all-MiniLM-L6-v2", "external"),
    ("djovak__multi-qa-MiniLM-L6-cos-v1", "external"),
    ("dangvantuan__french-document-embedding", "external"),
    ("morgendigital__multilingual-e5-large-quantized", "external"),
    ("lightonai__modernbert-embed-large", "external"),
    ("leeloolee__intention", "external"),
    ("hkunlp__instructor-large", "external"),
    ("nomic-ai__nomic-embed-text-v1.5", "external"),
    ("thenlper__gte-large-zh", "external"),
    ("jinaai__jina-embeddings-v2-base-es", "external"),
    ("nomic-ai__nomic-embed-text-v1", "external"),
]


def is_sha1(value):
    return len(value) == 40 and all(c in "0123456789abcdef" for c in value)


@pytest.mark.parametrize("model_rev_pair", model_rev_pairs)
def test_revision_is_specified_for_new_additions(model_rev_pair):
    """
    Models added after 26th of November should include a revision ID and can not use the "no_revision_available" fallback.
    """
    model_folder, rev_folder = model_rev_pair
    if (model_folder.name, rev_folder.name) in revision_exceptions:
        return  # ignore legacy results
    meta_file = rev_folder / "model_meta.json"
    with meta_file.open("r") as f:
        meta = json.load(f)
    rev = meta["revision"]
    assert rev.lower() not in [
        "no_revision_available",
        "external",
    ]
    assert (
        is_sha1(rev) or len(rev) == 1  # e.g. "1", "2", "3" etc. used for API versions
    )


@pytest.mark.parametrize("model_rev_pair", model_rev_pairs)
def test_organization_is_specified_for_new_additions(model_rev_pair):
    """
    Models added after 26th of November should include a organization ID within their name, e.g. "myorg/my_embedding_model".

    This is to avoid mispecified names such as "myorg__my_embedding_model" and similar.
    """
    model_folder, rev_folder = model_rev_pair
    meta_file = rev_folder / "model_meta.json"
    with meta_file.open("r") as f:
        meta = json.load(f)
    assert "/" in meta["name"]


@pytest.mark.parametrize("model_rev_pair", model_rev_pairs)
def test_that_revision_match(model_rev_pair):
    """
    Ensure that the revision in the path matches the one in the model_meta.json file.
    """
    model_folder, rev_folder = model_rev_pair
    meta_file = rev_folder / "model_meta.json"

    model_folder, rev_folder = model_rev_pair
    if (model_folder.name, rev_folder.name) in revision_exceptions:
        return  # ignore legacy results

    with meta_file.open("r") as f:
        meta = json.load(f)

    assert meta["revision"] == rev_folder.name


@pytest.mark.parametrize("model_folder", model_folders)
def test_no_duplicate_revisions(model_folder: Path):
    """
    Ensure that no folder have a duplicate revision.
    """

    revisions = set()
    for rev_folder in model_folder.iterdir():
        meta_path = rev_folder / "model_meta.json"
        if not meta_path.exists():
            revision = rev_folder.name
        else:
            with meta_path.open("r") as f:
                meta = json.load(f)
            revision = meta["revision"]

        assert (
            revision not in revisions
        ), f"Duplicate revision {revision} found in {rev_folder}. See model meta file {meta_path}"
        revisions.add(revision)
